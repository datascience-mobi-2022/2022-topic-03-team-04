---
title: "Project Topic 3 Team 4"
author: "Khalida Dushimova, Madleen Piegsa, Greata Karathanos und Richard Langi Efraim"
date: "4/27/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(heatmaply)
library(scales)
library(gganimate)
library(dplyr) ##for the select function 
library(tibble)
library(ggiraph)
library(ggiraphExtra)
library(ggplot2)
library(qqplotr)
```

## 1. Description of dataset (Raw data)



```{r 1.1 loading data}
#loading "RDeeP_A549_NS.csv" into Data.raw dataframe
#MS_Table <- read.table("~/Desktop/2022-topic-03-team-04/RDeeP_A549_NS.csv", header=TRUE, row.names=1, sep = ";")
Data.raw <- read.table("~/Desktop/2022-topic-03-team-04/RDeeP_A549_NS.csv", header=TRUE, row.names=1, sep = ";")
#creating a copy of Data.raw and saving it as Data.copy
Data.copy = Data.raw
```


```{r}
head(Data.copy)
dim(Data.copy)
# the dataset has 150 columns and 3680 rows
# restruction needed 
# we want to restructure the dataset by fractions and divide it in two datasets, one for RNAse and one for Ctrl
# we need to write a function that restructures the dataset
## Therefor we pick by repetitions and create Rep1, Rep2 and Rep3 vectors:starting with 1(Ctrl) or with 2(RNase) 
## every six columns there is a new fraction 
```



```{r 1.2 Raw data reorganization}
restructure_func = function(input_df,start){ #start = 1 for Ctrl and start = 2 for RNase.
  Vector.Rep1 <- c(seq(from =start, to = 150, by = 6)) # by 6 to reach the next fraction 
  Vector.Rep2 <- c(seq(from =start+2, to = 150, by = 6))
  Vector.Rep3 <- c(seq(from =start+4, to = 150, by = 6))
  output_df = as.data.frame(matrix(nrow = 3*3680, ncol=25)) 
  
  
  #Naming the fractions 
  for (i in 1:25) {
    s = paste("Fraction",i,sep="_")
   colnames(output_df)[i] = s
  }
  
  
  #Assignment of values and row names
  
  k = 1 #Row number of the old dataframe
  i = 1 #Row number of the new dataframe
  while (i <= dim(output_df)[1]) { # All Rows of the new dataframes will be selected
    output_df[i,] = input_df[k,Vector.Rep1] #The values of Rep 1 are assigned to the row
    row.names(output_df)[i] = paste(rownames(input_df)[k],"Rep",1,sep="_") #The row is given a name of Protein_Rep_1
    i = i + 1
    
    output_df[i,] = input_df[k,Vector.Rep2] # Repeat for Rep 2
    row.names(output_df)[i] = paste(rownames(input_df)[k],"Rep",2,sep="_")
    i = i + 1
    
    output_df[i,] = input_df[k,Vector.Rep3] # Repeat for Rep 3
    row.names(output_df)[i] = paste(rownames(input_df)[k],"Rep",3,sep="_")
    i = i + 1
    
    k = k + 1 # The row of the old dataframe is advanced by 1
  }
  return(output_df)
}
Ctrl = restructure_func(Data.copy,1)
RNase = restructure_func(Data.copy,2)
```



```{r}
Ctrl = t(Ctrl)
Ctrl = data.frame(Ctrl) ## In order to be able to use the select function

RNase = t(RNase)
RNase = data.frame(RNase)

```








```{r Plots for SPB6_Human_Protein}
Fractions = c(1:25)
SPB6_Human_Protein_Ctrl = ggplot() + 
  geom_line(data = select(Ctrl,1),  aes(x = Fractions, y = SPB6_HUMAN_Rep_1, color= 'Ctrl_Rep1')) + 
  
  geom_line(data = select(Ctrl,2),  aes(x = Fractions, y = SPB6_HUMAN_Rep_2 , color= 'Ctrl_Rep2')) + 
  
  geom_line(data = select(Ctrl,3),  aes(x = Fractions, y = SPB6_HUMAN_Rep_3 , color= 'Ctrl_Rep3')) +
  
  scale_colour_manual(name="legend",values=c(Ctrl_Rep1="blue2",Ctrl_Rep2="cyan3", Ctrl_Rep3="violetred4")) +
  
  labs(title="SPB6_HUMAN_Ctrl", y= "Protein Amount") 
 SPB6_Human_Protein_Ctrl + scale_x_continuous(breaks = seq(1, 25, by = 1))
  
  
SPB6_Human_Protein_RNase = ggplot() + 
  geom_line(data = select(RNase,1),  aes(x = Fractions, y = SPB6_HUMAN_Rep_1 , color= 'RNase_Rep1')) + 
  
  geom_line(data = select(RNase,2), aes(x = Fractions, y = SPB6_HUMAN_Rep_2, color= 'RNase_Rep2')) +
  
  geom_line(data = select(RNase,3), aes(x = Fractions, y = SPB6_HUMAN_Rep_3, color= 'RNase_Rep3')) +
  
   scale_colour_manual(name="legend",values=c(RNase_Rep1="blue2",RNase_Rep2="cyan3", RNase_Rep3= "violetred4")) +
  
  labs(title="SPB6_HUMAN_RNase", y= "Protein Amount") 
  SPB6_Human_Protein_RNase + scale_x_continuous(breaks = seq(1, 25, by = 1))
  
 
  
SPB6_Human_Protein = ggplot() +
 geom_line(data = select(Ctrl,1),  aes(x = Fractions, y = SPB6_HUMAN_Rep_1, color= 'Ctrl_Rep1')) + 
  
  geom_line(data = select(Ctrl,2),  aes(x = Fractions, y = SPB6_HUMAN_Rep_2 , color= 'Ctrl_Rep2')) + 
  
  geom_line(data = select(Ctrl,3),  aes(x = Fractions, y = SPB6_HUMAN_Rep_3 , color= 'Ctrl_Rep3')) +
  
  geom_line(data = select(RNase,1),  aes(x = Fractions, y = SPB6_HUMAN_Rep_1 , color= 'RNase_Rep1')) + 
  
  geom_line(data = select(RNase,2), aes(x = Fractions, y = SPB6_HUMAN_Rep_2, color= 'RNase_Rep2')) +
  
  geom_line(data = select(RNase,3), aes(x = Fractions, y = SPB6_HUMAN_Rep_3 , color= 'RNase_Rep3')) +
  
  scale_colour_manual(name="legend",values=c(Ctrl_Rep1="blue2",RNase_Rep1="cyan3", Ctrl_Rep2="violetred4", RNase_Rep2="tomato1",Ctrl_Rep3="darkviolet", RNase_Rep3="pink")) +
  
  labs(title="SPB6_HUMAN", y= "Protein Amount") 
  SPB6_Human_Protein + scale_x_continuous(breaks = seq(1, 25, by = 1))
 
# RNA associates with proteins to form RNA-Protein complexes that play key regulatory roles in cellular processes --> RNA metabolism and the regulation of gene expression 
# concept of RNA dependence (R-DeeP) describes proteins and protein complexes whose interactions are directly or indirectly dependent on the presence of RNA 
# aim: identify RNA-dependent proteins from the position of the proteins in an untreated cell lysate as t
```


```{r}
Fractions = c(1:25)
MICA_HUMAN_Protein  = ggplot() +
 geom_line(data = select(Ctrl, contains("MICA_HUMAN_Rep_1")),  aes(x = Fractions, y = MICA_HUMAN_Rep_1, color= 'Ctrl_Rep1')) + 
  
  geom_line(data = select(Ctrl, contains("MICA_HUMAN_Rep_2")),  aes(x = Fractions, y = MICA_HUMAN_Rep_2, color= 'Ctrl_Rep2')) + 
  
  geom_line(data = select(Ctrl, contains("MICA_HUMAN_Rep_3")),  aes(x = Fractions, y = MICA_HUMAN_Rep_3 , color= 'Ctrl_Rep3')) +
  
  geom_line(data = select(RNase, contains("MICA_HUMAN_Rep_1")),  aes(x = Fractions, y = MICA_HUMAN_Rep_1 , color= 'RNase_Rep1')) + 
  
  geom_line(data = select(RNase, contains("MICA_HUMAN_Rep_2")), aes(x = Fractions, y = MICA_HUMAN_Rep_2, color= 'RNase_Rep2')) +
  
  geom_line(data = select(RNase, contains("MICA_HUMAN_Rep_3")), aes(x = Fractions, y = MICA_HUMAN_Rep_3 , color= 'RNase_Rep3')) +
  
  scale_colour_manual(name="legend",values=c(Ctrl_Rep1="blue2",RNase_Rep1="green4", Ctrl_Rep2="magenta1", RNase_Rep2="tomato1",Ctrl_Rep3="darkviolet", RNase_Rep3="turquoise4")) +
  
  labs(title="MICA_HUMAN_Protein", y= "Protein Amount") 
  MICA_HUMAN_Protein + scale_x_continuous(breaks = seq(1, 25, by = 1))
  
MICA_HUMAN_Protein_Ctrl = ggplot() + 
  geom_line(data = select(Ctrl, contains("MICA_HUMAN_Rep_1")),  aes(x = Fractions, y = MICA_HUMAN_Rep_1, color= 'Ctrl_Rep1')) + 
  
  geom_line(data = select(Ctrl, contains("MICA_HUMAN_Rep_2")),  aes(x = Fractions, y = MICA_HUMAN_Rep_2 , color= 'Ctrl_Rep2')) + 
  
  geom_line(data = select(Ctrl, contains("MICA_HUMAN_Rep_3")),  aes(x = Fractions, y = MICA_HUMAN_Rep_3 , color= 'Ctrl_Rep3')) +
  
  scale_colour_manual(name="legend",values=c(Ctrl_Rep1="blue2",Ctrl_Rep2="purple4", Ctrl_Rep3="magenta1")) +
  
  labs(title="MICA_HUMAN_Ctrl", y= "Protein Amount") 
 MICA_HUMAN_Protein_Ctrl + scale_x_continuous(breaks = seq(1, 25, by = 1))
  
  
MICA_Human_Protein_RNase = ggplot() + 
  geom_line(data = select(RNase, contains("MICA_HUMAN_Rep_1")),  aes(x = Fractions, y = MICA_HUMAN_Rep_1 , color= 'RNase_Rep1')) + 
  
  geom_line(data = select(RNase,contains("MICA_HUMAN_Rep_2")), aes(x = Fractions, y = MICA_HUMAN_Rep_2, color= 'RNase_Rep2')) +
  
  geom_line(data = select(RNase,contains("MICA_HUMAN_Rep_3")), aes(x = Fractions, y = MICA_HUMAN_Rep_3, color= 'RNase_Rep3')) +
  
   scale_colour_manual(name="legend",values=c(RNase_Rep1="blue2",RNase_Rep2="green4", RNase_Rep3= "magenta1")) +
  
  labs(title="MICA_HUMAN_RNase", y= "Protein Amount") 
  MICA_Human_Protein_RNase + scale_x_continuous(breaks = seq(1, 25, by = 1))  
```







## 1. Evaluation of the reproducibility of the experiments 

To investigate the protein amount of the replicates further we sum up the total protein amount of all genes per sample replicate and plot them side by side in a bar plot. We can see that there is a huge difference between the RNase samples and also the Ctrl samples do not align.

In conclusion the protein amounts differ and are not well comparable. 

Possible causes for this fluctuation of the protein amounts lay in the experimental design of the data generation. The sucrose gradients were all produced in one step to minimize the variations. But had to be transported to the ultracentrifugation and were then fractioned by hand. And as we see the lysates can differ in their containing protein amount.




```{r}
Rep_1_Ctrl <- Ctrl %>% select(contains("Rep_1"))
Rep_1_Ctrl_sums = colSums(Rep_1_Ctrl) 
Rep_2_Ctrl <- Ctrl %>% select(contains("Rep_2"))
Rep_2_Ctrl_sums = colSums(Rep_2_Ctrl) 
Rep_3_Ctrl <- Ctrl %>% select(contains("Rep_3"))
Rep_3_Ctrl_sums = colSums(Rep_3_Ctrl) 

Rep_1_RNase <- RNase %>% select(contains("Rep_1"))
Rep_1_RNase_sums = colSums(Rep_1_RNase)
Rep_2_RNase <- RNase %>% select(contains("Rep_2"))
Rep_2_RNase_sums = colSums(Rep_2_RNase)
Rep_3_RNase <- RNase %>% select(contains("Rep_3"))
Rep_3_RNase_sums = colSums(Rep_3_RNase)

Ctrl_sums = cbind(Rep_1_Ctrl_sums, Rep_2_Ctrl_sums, Rep_3_Ctrl_sums)
RNase_sums = cbind(Rep_1_RNase_sums, Rep_2_RNase_sums, Rep_3_RNase_sums)

Ctrl_RNase_sums = cbind(Ctrl_sums, RNase_sums)

Total_Protein_amount = colSums(Ctrl_RNase_sums)
Total_Protein_amount

value = Total_Protein_amount
plotdata = data.frame(value, names=c("Ctrl1", "Ctrl2", "Ctrl3", "RNase1", "RNase2", "RNase3"))
ggplot(data = plotdata, aes(x = names, y = value)) + geom_bar(stat = "identity")                      
                          
```










## 2. Normalization (Fractionwise)



```{r}
Rep_1_Ctrl_f = t(Rep_1_Ctrl)
Rep_1_Ctrl_fsums = colSums(Rep_1_Ctrl_f)


Rep_2_Ctrl_f = t(Rep_2_Ctrl)
Rep_2_Ctrl_fsums = colSums(Rep_2_Ctrl_f)


Rep_3_Ctrl_f = t(Rep_3_Ctrl)
Rep_3_Ctrl_fsums = colSums(Rep_3_Ctrl_f)


Rep_1_RNase_f = t(Rep_1_RNase)
Rep_1_RNase_fsums =colSums(Rep_1_RNase_f)

Rep_2_RNase_f = t(Rep_2_RNase)
Rep_2_RNase_fsums = colSums(Rep_2_RNase_f)

Rep_3_RNase_f = t(Rep_3_RNase)
Rep_3_RNase_fsums = colSums(Rep_3_RNase_f)

Total_Protein_by_fractions = cbind(Rep_1_Ctrl_fsums,Rep_2_Ctrl_fsums, Rep_3_Ctrl_fsums, Rep_1_RNase_fsums, Rep_2_RNase_fsums, Rep_3_RNase_fsums)


Total_Protein_norm = t(Total_Protein_by_fractions)/Total_Protein_amount
Total_Protein_norm = as.data.frame(Total_Protein_norm)
Total_Protein_amount_norm = rowSums(Total_Protein_norm)
barplot(Total_Protein_amount_norm)





```



```{r by Richard}
#Data Normalization Z Transformation Method
Data.norm.ctrl.scaled <- as.data.frame(scale(Ctrl[1:11040]))
head(Data.norm.ctrl.scaled)
Data.norm.RNase.scaled <- as.data.frame(scale(RNase[1:11040]))
head(Data.norm.RNase.scaled)
#Data Normalization Z Transformation Method Using Formula
Data.norm.ctrl.z <- as.data.frame(apply(Ctrl,2,function(x){(x-mean(x))/sd(x)}))
head(Data.norm.ctrl.z)
Data.norm.RNase.z <- as.data.frame(apply(RNase,2,function(x){(x-mean(x))/sd(x)}))
head(Data.norm.RNase.z)
#Both results should be the same
```



```{r}

Fractions = c(1:25)
SPB6_Human_Protein_Ctrl_norm_z = ggplot() + 
  geom_line(data = select(Data.norm.ctrl.z,1),  aes(x = Fractions, y = SPB6_HUMAN_Rep_1, color= 'Ctrl_Rep1')) + 
  
  geom_line(data = select(Data.norm.ctrl.z,2),  aes(x = Fractions, y = SPB6_HUMAN_Rep_2 , color= 'Ctrl_Rep2')) + 
  
  geom_line(data = select(Data.norm.ctrl.z,3),  aes(x = Fractions, y = SPB6_HUMAN_Rep_3 , color= 'Ctrl_Rep3')) +
  
  scale_colour_manual(name="legend",values=c(Ctrl_Rep1="blue2",Ctrl_Rep2="cyan3", Ctrl_Rep3="violetred4")) +
  
  labs(title="SPB6_HUMAN_Ctrl_Normalized_Z", y= "Protein Amount") 
 SPB6_Human_Protein_Ctrl_norm + scale_x_continuous(breaks = seq(1, 25, by = 1))
  
  
SPB6_Human_Protein_RNase_norm_z = ggplot() + 
  geom_line(data = select(Data.norm.RNase.z,1),  aes(x = Fractions, y = SPB6_HUMAN_Rep_1 , color= 'RNase_Rep1')) + 
  
  geom_line(data = select(Data.norm.RNase.z,2), aes(x = Fractions, y = SPB6_HUMAN_Rep_2, color= 'RNase_Rep2')) +
  
  geom_line(data = select(Data.norm.RNase.z,3), aes(x = Fractions, y = SPB6_HUMAN_Rep_3, color= 'RNase_Rep3')) +
  
   scale_colour_manual(name="legend",values=c(RNase_Rep1="blue2",RNase_Rep2="cyan3", RNase_Rep3= "violetred4")) +
  
  labs(title="SPB6_HUMAN_RNase_Normalized_Z", y= "Protein Amount") 
  SPB6_Human_Protein_RNase_norm_z + scale_x_continuous(breaks = seq(1, 25, by = 1))
  
```


##
Main motivation is to determine the role of RNA or non coding RNA in the cell, as RNA molecules are much more than a template for protein production
screen RNA --> molecular mechanisms 
screen proteins and protein complexes (with known functions) which are interacting with RNA  --> new funcions RNA
RBPs --> RNA binding Proteins (Cancer, Neurological disorder, muscular atrophies)
IDEA: identify proteins and complexes affected by RNA
The concept of RNA dependence
A protein is definied as RNA dependent if its molecular interactions are dependent on RNA presence 
RNA dependent protein = RNA binding Proteins (RBP) + RBP-binding proteins (if RBP bound to RNA)
protein wide screen based on succrose density gradient 
Control 
proteins envolved in RNA dependent complex --> same fraction migartion
RNAse
RNA dependent protein complex  will dissociate and individual proteins will migrate in different fractions--> different fractions
Analisis of the protein content of fractions by comparing Control and RNAse samples allows identifacation of RNA dependent shifts 
Normalization is needed in order to compare the data in RNase treted and Control samples 
## 3. Peaks identification
distribution of protein in 25 fractions of both samples, Control and RNase
find global and local maxima for both 
how to define a maximum in order to allow the program to find the right fraction 
t-test 
## 4. Fit of the protein profiles
## 5. 
